{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.35.1.17967",
      "templateHash": "16914412420829429330"
    }
  },
  "parameters": {
    "suffix": {
      "type": "string",
      "metadata": {
        "description": "Suffix for resource names"
      }
    },
    "environment": {
      "type": "string",
      "metadata": {
        "description": "Environment for resource names"
      }
    },
    "workloadName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Workload name for resource names"
      }
    }
  },
  "variables": {
    "prefix": "[if(not(empty(parameters('workloadName'))), createArray(parameters('workloadName')), createArray())]",
    "suffixArray": [
      "[parameters('suffix')]",
      "[parameters('environment')]"
    ],
    "getResourceNameWithConstraints": {
      "st": "[take(replace(join(concat(variables('prefix'), createArray('st'), variables('suffixArray')), '-'), '-', ''), 24)]",
      "kv": "[take(join(concat(variables('prefix'), createArray('kv'), variables('suffixArray')), '-'), 24)]",
      "law": "[take(join(concat(variables('prefix'), createArray('law'), variables('suffixArray')), '-'), 63)]",
      "vnet": "[take(join(concat(variables('prefix'), createArray('vnet'), variables('suffixArray')), '-'), 64)]",
      "apim": "[take(join(concat(variables('prefix'), createArray('apim'), variables('suffixArray')), '-'), 50)]",
      "ase": "[take(join(concat(variables('prefix'), createArray('ase'), variables('suffixArray')), '-'), 40)]",
      "sb": "[take(join(concat(variables('prefix'), createArray('sb'), variables('suffixArray')), '-'), 50)]"
    },
    "storageAccountName": "[replace(variables('getResourceNameWithConstraints').st, '-', '')]",
    "keyVaultName": "[variables('getResourceNameWithConstraints').kv]",
    "logAnalyticsWorkspaceName": "[variables('getResourceNameWithConstraints').law]",
    "vnetName": "[variables('getResourceNameWithConstraints').vnet]",
    "apiManagementName": "[variables('getResourceNameWithConstraints').apim]",
    "appServiceEnvironmentName": "[variables('getResourceNameWithConstraints').ase]",
    "serviceBusNamespaceName": "[variables('getResourceNameWithConstraints').sb]"
  },
  "resources": [],
  "outputs": {
    "logAnalyticsWorkspaceName": {
      "type": "string",
      "value": "[variables('logAnalyticsWorkspaceName')]"
    },
    "vnetName": {
      "type": "string",
      "value": "[variables('vnetName')]"
    },
    "keyVaultName": {
      "type": "string",
      "value": "[variables('keyVaultName')]"
    },
    "apiManagementName": {
      "type": "string",
      "value": "[variables('apiManagementName')]"
    },
    "appServiceEnvironmentName": {
      "type": "string",
      "value": "[variables('appServiceEnvironmentName')]"
    },
    "storageAccountName": {
      "type": "string",
      "value": "[variables('storageAccountName')]"
    },
    "serviceBusNamespaceName": {
      "type": "string",
      "value": "[variables('serviceBusNamespaceName')]"
    }
  }
}